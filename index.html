import React, { useState } from ‘react’;
import { FileText, Download, Eye, Code, Smartphone } from ‘lucide-react’;

const HtmlToPdfConverter = () => {
const [htmlCode, setHtmlCode] = useState(`<!DOCTYPE html>

<html>
<head>
    <title>Sample Document</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 40px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .highlight {
            background-color: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>My Document</h1>
    <p>This is a <span class="highlight">sample document</span> that will be converted to PDF.</p>
    <p>You can include any HTML content here including:</p>
    <ul>
        <li>Lists and bullets</li>
        <li>Styled text and colors</li>
        <li>Headers and paragraphs</li>
        <li>Tables and more</li>
    </ul>
</body>
</html>`);

const [previewMode, setPreviewMode] = useState(false);
const [isGenerating, setIsGenerating] = useState(false);

const generatePDF = () => {
setIsGenerating(true);

```
try {
  // Create a hidden iframe to avoid popup blockers
  const iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  document.body.appendChild(iframe);
  
  // Get the iframe's document
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  
  // Write HTML content with PDF-optimized styles
  const pdfOptimizedHtml = `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <style>
        @media print {
          body { 
            margin: 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }
          @page { 
            margin: 0.75in;
            size: A4;
          }
        }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
          line-height: 1.4;
          color: #000;
        }
      </style>
    </head>
    <body>
      ${htmlCode.replace(/<!DOCTYPE html>|<html[^>]*>|<\/html>|<head[^>]*>[\s\S]*?<\/head>|<body[^>]*>|<\/body>/gi, '')}
    </body>
    </html>
  `;
  
  iframeDoc.open();
  iframeDoc.write(pdfOptimizedHtml);
  iframeDoc.close();
  
  // Wait a moment for content to render, then print
  setTimeout(() => {
    try {
      iframe.contentWindow.focus();
      iframe.contentWindow.print();
    } catch (e) {
      // Fallback: try direct print
      window.print();
    }
    
    // Clean up iframe after a delay
    setTimeout(() => {
      document.body.removeChild(iframe);
      setIsGenerating(false);
    }, 1000);
  }, 500);
  
} catch (error) {
  console.error('Error generating PDF:', error);
  alert('Error generating PDF. Please try again.');
  setIsGenerating(false);
}
```

};

const togglePreview = () => {
setPreviewMode(!previewMode);
};

return (
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
<div className="max-w-6xl mx-auto">
{/* Header */}
<div className="bg-white rounded-xl shadow-lg p-6 mb-6">
<div className="flex items-center justify-between flex-wrap gap-4">
<div className="flex items-center space-x-3">
<div className="bg-blue-500 p-3 rounded-lg">
<FileText className="text-white w-6 h-6" />
</div>
<div>
<h1 className="text-2xl font-bold text-gray-800">HTML to PDF Converter</h1>
<p className="text-gray-600 flex items-center gap-2 mt-1">
<Smartphone className="w-4 h-4" />
iOS Compatible
</p>
</div>
</div>

```
        <div className="flex space-x-3">
          <button
            onClick={togglePreview}
            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ${
              previewMode 
                ? 'bg-gray-500 text-white' 
                : 'bg-green-500 text-white hover:bg-green-600'
            }`}
          >
            {previewMode ? <Code className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
            <span>{previewMode ? 'Edit HTML' : 'Preview'}</span>
          </button>
          
          <button
            onClick={generatePDF}
            disabled={isGenerating}
            className="flex items-center space-x-2 bg-blue-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <Download className="w-4 h-4" />
            <span>{isGenerating ? 'Generating...' : 'Export PDF'}</span>
          </button>
        </div>
      </div>
    </div>

    {/* Main Content */}
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      {/* HTML Editor */}
      <div className={`${previewMode ? 'hidden lg:block' : ''}`}>
        <div className="bg-white rounded-xl shadow-lg overflow-hidden">
          <div className="bg-gray-50 px-6 py-4 border-b">
            <h2 className="font-semibold text-gray-800 flex items-center gap-2">
              <Code className="w-5 h-5" />
              HTML Editor
            </h2>
          </div>
          <div className="p-6">
            <textarea
              value={htmlCode}
              onChange={(e) => setHtmlCode(e.target.value)}
              className="w-full h-96 font-mono text-sm border border-gray-300 rounded-lg p-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
              placeholder="Enter your HTML code here..."
            />
          </div>
        </div>
      </div>

      {/* Preview */}
      <div className={`${!previewMode ? 'hidden lg:block' : ''}`}>
        <div className="bg-white rounded-xl shadow-lg overflow-hidden">
          <div className="bg-gray-50 px-6 py-4 border-b">
            <h2 className="font-semibold text-gray-800 flex items-center gap-2">
              <Eye className="w-5 h-5" />
              Preview
            </h2>
          </div>
          <div className="p-6">
            <div 
              className="border border-gray-200 rounded-lg p-4 bg-white min-h-96 overflow-auto"
              dangerouslySetInnerHTML={{ __html: htmlCode }}
            />
          </div>
        </div>
      </div>
    </div>

    {/* Instructions */}
    <div className="bg-white rounded-xl shadow-lg p-6 mt-6">
      <h3 className="font-semibold text-gray-800 mb-4">How to use on iOS:</h3>
      <div className="grid md:grid-cols-2 gap-6 text-sm text-gray-600">
        <div>
          <h4 className="font-medium text-gray-800 mb-2">Step 1: Edit HTML</h4>
          <p>Paste or write your HTML code in the editor. You can include CSS styles within &lt;style&gt; tags.</p>
        </div>
        <div>
          <h4 className="font-medium text-gray-800 mb-2">Step 2: Preview</h4>
          <p>Use the Preview button to see how your HTML will look when converted to PDF.</p>
        </div>
        <div>
          <h4 className="font-medium text-gray-800 mb-2">Step 3: Export PDF</h4>
          <p>Click "Export PDF" to open the print dialog. On iOS, select "Save to Files" or "Save PDF to Books".</p>
        </div>
        <div>
          <h4 className="font-medium text-gray-800 mb-2">iOS Tips</h4>
          <p>In Safari, you can also use Share → "Create PDF" from any preview for additional options.</p>
        </div>
      </div>
    </div>
  </div>
</div>
```

);
};

export default HtmlToPdfConverter;
